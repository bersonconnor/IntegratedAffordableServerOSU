{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _handler = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(apiOptions, actions) {\n    var updateNotifications, getSelectedResources, getNotifications, getMessage, notificationId, notificationChildId, onStart, onSuccess, onProgress, resources, quantity, _resources$, id, name, downloadUrl, archiveName, content;\n\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            updateNotifications = actions.updateNotifications, getSelectedResources = actions.getSelectedResources, getNotifications = actions.getNotifications;\n            getMessage = _translations2.default.bind(null, apiOptions.locale);\n            notificationId = label;\n            notificationChildId = (0, _nanoid2.default)();\n\n            onStart = function onStart(_ref2) {\n              var archiveName = _ref2.archiveName,\n                  quantity = _ref2.quantity;\n              var notifications = getNotifications();\n\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n\n              var childElement = {\n                elementType: 'NotificationProgressItem',\n                elementProps: {\n                  title: getMessage('creatingName', {\n                    name: archiveName\n                  }),\n                  progress: 0\n                }\n              };\n\n              var newChildren = _notifications2.default.addChild(notification && notification.children || [], notificationChildId, childElement);\n\n              var newNotification = {\n                title: quantity > 1 ? getMessage('zippingItems', {\n                  quantity: quantity\n                }) : getMessage('zippingItem'),\n                children: newChildren\n              };\n              var newNotifications = notification ? _notifications2.default.updateNotification(notifications, notificationId, newNotification) : _notifications2.default.addNotification(notifications, notificationId, newNotification);\n              updateNotifications(newNotifications);\n            };\n\n            onSuccess = function onSuccess(_) {\n              var notifications = getNotifications();\n\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n\n              var notificationChildrenCount = notification.children.length;\n              var newNotifications = void 0;\n\n              if (notificationChildrenCount > 1) {\n                newNotifications = _notifications2.default.updateNotification(notifications, notificationId, {\n                  children: _notifications2.default.removeChild(notification.children, notificationChildId)\n                });\n              } else {\n                newNotifications = _notifications2.default.removeNotification(notifications, notificationId);\n              }\n\n              updateNotifications(newNotifications);\n            };\n\n            onProgress = function onProgress(progress) {\n              var notifications = getNotifications();\n\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n\n              var child = _notifications2.default.getChild(notification.children, notificationChildId);\n\n              var newChild = (0, _extends3.default)({}, child, {\n                element: (0, _extends3.default)({}, child.element, {\n                  elementProps: (0, _extends3.default)({}, child.element.elementProps, {\n                    progress: progress\n                  })\n                })\n              });\n\n              var newChildren = _notifications2.default.updateChild(notification.children, notificationChildId, newChild);\n\n              var newNotifications = _notifications2.default.updateNotification(notifications, notificationId, {\n                children: newChildren\n              });\n\n              updateNotifications(newNotifications);\n            };\n\n            _context.prev = 7;\n            resources = getSelectedResources();\n            quantity = resources.length;\n\n            if (!(quantity === 1)) {\n              _context.next = 18;\n              break;\n            }\n\n            _resources$ = resources[0], id = _resources$.id, name = _resources$.name;\n            downloadUrl = apiOptions.apiRoot + '/download?items=' + id; // check if the file is available and trigger native browser saving prompt\n            // if server is down the error will be catched and trigger relevant notification\n\n            _context.next = 15;\n            return _api2.default.getResourceById(apiOptions, id);\n\n          case 15:\n            (0, _download.promptToSaveBlob)({\n              name: name,\n              downloadUrl: downloadUrl\n            });\n            _context.next = 25;\n            break;\n\n          case 18:\n            // multiple resources -> download as a single archive\n            archiveName = apiOptions.archiveName || 'archive.zip';\n            onStart({\n              archiveName: archiveName,\n              quantity: quantity\n            });\n            _context.next = 22;\n            return _api2.default.downloadResources({\n              resources: resources,\n              apiOptions: apiOptions,\n              onProgress: onProgress\n            });\n\n          case 22:\n            content = _context.sent;\n            setTimeout(onSuccess, 1000);\n            (0, _download.promptToSaveBlob)({\n              content: content,\n              name: archiveName\n            });\n\n          case 25:\n            _context.next = 31;\n            break;\n\n          case 27:\n            _context.prev = 27;\n            _context.t0 = _context['catch'](7);\n            (0, _onFailError2.default)({\n              getNotifications: getNotifications,\n              label: getMessage(label),\n              notificationId: notificationId,\n              updateNotifications: updateNotifications\n            });\n            console.log(_context.t0);\n\n          case 31:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this, [[7, 27]]);\n  }));\n\n  return function _handler(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar _api = require('../api');\n\nvar _api2 = _interopRequireDefault(_api);\n\nvar _notifications = require('../utils/notifications');\n\nvar _notifications2 = _interopRequireDefault(_notifications);\n\nvar _download = require('../utils/download');\n\nvar _onFailError = require('../utils/onFailError');\n\nvar _onFailError2 = _interopRequireDefault(_onFailError);\n\nvar _nanoid = require('nanoid');\n\nvar _nanoid2 = _interopRequireDefault(_nanoid);\n\nvar _iconsSvg = require('../icons-svg');\n\nvar _iconsSvg2 = _interopRequireDefault(_iconsSvg);\n\nvar _translations = require('../translations');\n\nvar _translations2 = _interopRequireDefault(_translations);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar label = 'download';\n\nexports.default = function (apiOptions, actions) {\n  var localeLabel = (0, _translations2.default)(apiOptions.locale, label);\n  var getSelectedResources = actions.getSelectedResources;\n  return {\n    id: label,\n    icon: {\n      svg: _iconsSvg2.default.fileDownload\n    },\n    label: localeLabel,\n    shouldBeAvailable: function shouldBeAvailable(apiOptions) {\n      var selectedResources = getSelectedResources();\n      return selectedResources.length > 0 && !selectedResources.some(function (r) {\n        return r.type === 'dir';\n      }) && selectedResources.every(function (r) {\n        return r.capabilities.canDownload;\n      });\n    },\n    availableInContexts: ['row', 'toolbar'],\n    handler: function handler() {\n      return _handler(apiOptions, actions);\n    }\n  };\n};","map":{"version":3,"sources":["/home/ubuntu/Connor/Demo_OSU_Filemanager/node_modules/@opuscapita/react-filemanager-connector-node-v1/lib/capabilities/download.js"],"names":["Object","defineProperty","exports","value","_regenerator","require","_regenerator2","_interopRequireDefault","_extends2","_extends3","_asyncToGenerator2","_asyncToGenerator3","_handler","_ref","default","mark","_callee","apiOptions","actions","updateNotifications","getSelectedResources","getNotifications","getMessage","notificationId","notificationChildId","onStart","onSuccess","onProgress","resources","quantity","_resources$","id","name","downloadUrl","archiveName","content","wrap","_callee$","_context","prev","next","_translations2","bind","locale","label","_nanoid2","_ref2","notifications","notification","_notifications2","getNotification","childElement","elementType","elementProps","title","progress","newChildren","addChild","children","newNotification","newNotifications","updateNotification","addNotification","_","notificationChildrenCount","length","removeChild","removeNotification","child","getChild","newChild","element","updateChild","apiRoot","_api2","getResourceById","_download","promptToSaveBlob","downloadResources","sent","setTimeout","t0","_onFailError2","console","log","stop","_x","_x2","apply","arguments","_api","_notifications","_onFailError","_nanoid","_iconsSvg","_iconsSvg2","_translations","obj","__esModule","localeLabel","icon","svg","fileDownload","shouldBeAvailable","selectedResources","some","r","type","every","capabilities","canDownload","availableInContexts","handler"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _handler = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(apiOptions, actions) {\n    var updateNotifications, getSelectedResources, getNotifications, getMessage, notificationId, notificationChildId, onStart, onSuccess, onProgress, resources, quantity, _resources$, id, name, downloadUrl, archiveName, content;\n\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            updateNotifications = actions.updateNotifications, getSelectedResources = actions.getSelectedResources, getNotifications = actions.getNotifications;\n            getMessage = _translations2.default.bind(null, apiOptions.locale);\n            notificationId = label;\n            notificationChildId = (0, _nanoid2.default)();\n\n            onStart = function onStart(_ref2) {\n              var archiveName = _ref2.archiveName,\n                  quantity = _ref2.quantity;\n\n              var notifications = getNotifications();\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n\n              var childElement = {\n                elementType: 'NotificationProgressItem',\n                elementProps: {\n                  title: getMessage('creatingName', { name: archiveName }),\n                  progress: 0\n                }\n              };\n\n              var newChildren = _notifications2.default.addChild(notification && notification.children || [], notificationChildId, childElement);\n              var newNotification = {\n                title: quantity > 1 ? getMessage('zippingItems', { quantity: quantity }) : getMessage('zippingItem'),\n                children: newChildren\n              };\n\n              var newNotifications = notification ? _notifications2.default.updateNotification(notifications, notificationId, newNotification) : _notifications2.default.addNotification(notifications, notificationId, newNotification);\n\n              updateNotifications(newNotifications);\n            };\n\n            onSuccess = function onSuccess(_) {\n              var notifications = getNotifications();\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n              var notificationChildrenCount = notification.children.length;\n              var newNotifications = void 0;\n\n              if (notificationChildrenCount > 1) {\n                newNotifications = _notifications2.default.updateNotification(notifications, notificationId, {\n                  children: _notifications2.default.removeChild(notification.children, notificationChildId)\n                });\n              } else {\n                newNotifications = _notifications2.default.removeNotification(notifications, notificationId);\n              }\n              updateNotifications(newNotifications);\n            };\n\n            onProgress = function onProgress(progress) {\n              var notifications = getNotifications();\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n              var child = _notifications2.default.getChild(notification.children, notificationChildId);\n\n              var newChild = (0, _extends3.default)({}, child, {\n                element: (0, _extends3.default)({}, child.element, {\n                  elementProps: (0, _extends3.default)({}, child.element.elementProps, {\n                    progress: progress\n                  })\n                })\n              });\n              var newChildren = _notifications2.default.updateChild(notification.children, notificationChildId, newChild);\n              var newNotifications = _notifications2.default.updateNotification(notifications, notificationId, { children: newChildren });\n              updateNotifications(newNotifications);\n            };\n\n            _context.prev = 7;\n            resources = getSelectedResources();\n            quantity = resources.length;\n\n            if (!(quantity === 1)) {\n              _context.next = 18;\n              break;\n            }\n\n            _resources$ = resources[0], id = _resources$.id, name = _resources$.name;\n            downloadUrl = apiOptions.apiRoot + '/download?items=' + id;\n            // check if the file is available and trigger native browser saving prompt\n            // if server is down the error will be catched and trigger relevant notification\n\n            _context.next = 15;\n            return _api2.default.getResourceById(apiOptions, id);\n\n          case 15:\n            (0, _download.promptToSaveBlob)({ name: name, downloadUrl: downloadUrl });\n            _context.next = 25;\n            break;\n\n          case 18:\n            // multiple resources -> download as a single archive\n            archiveName = apiOptions.archiveName || 'archive.zip';\n\n            onStart({ archiveName: archiveName, quantity: quantity });\n            _context.next = 22;\n            return _api2.default.downloadResources({ resources: resources, apiOptions: apiOptions, onProgress: onProgress });\n\n          case 22:\n            content = _context.sent;\n\n            setTimeout(onSuccess, 1000);\n            (0, _download.promptToSaveBlob)({ content: content, name: archiveName });\n\n          case 25:\n            _context.next = 31;\n            break;\n\n          case 27:\n            _context.prev = 27;\n            _context.t0 = _context['catch'](7);\n\n            (0, _onFailError2.default)({\n              getNotifications: getNotifications,\n              label: getMessage(label),\n              notificationId: notificationId,\n              updateNotifications: updateNotifications\n            });\n            console.log(_context.t0);\n\n          case 31:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this, [[7, 27]]);\n  }));\n\n  return function _handler(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar _api = require('../api');\n\nvar _api2 = _interopRequireDefault(_api);\n\nvar _notifications = require('../utils/notifications');\n\nvar _notifications2 = _interopRequireDefault(_notifications);\n\nvar _download = require('../utils/download');\n\nvar _onFailError = require('../utils/onFailError');\n\nvar _onFailError2 = _interopRequireDefault(_onFailError);\n\nvar _nanoid = require('nanoid');\n\nvar _nanoid2 = _interopRequireDefault(_nanoid);\n\nvar _iconsSvg = require('../icons-svg');\n\nvar _iconsSvg2 = _interopRequireDefault(_iconsSvg);\n\nvar _translations = require('../translations');\n\nvar _translations2 = _interopRequireDefault(_translations);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar label = 'download';\n\nexports.default = function (apiOptions, actions) {\n  var localeLabel = (0, _translations2.default)(apiOptions.locale, label);\n  var getSelectedResources = actions.getSelectedResources;\n\n  return {\n    id: label,\n    icon: { svg: _iconsSvg2.default.fileDownload },\n    label: localeLabel,\n    shouldBeAvailable: function shouldBeAvailable(apiOptions) {\n      var selectedResources = getSelectedResources();\n\n      return selectedResources.length > 0 && !selectedResources.some(function (r) {\n        return r.type === 'dir';\n      }) && selectedResources.every(function (r) {\n        return r.capabilities.canDownload;\n      });\n    },\n    availableInContexts: ['row', 'toolbar'],\n    handler: function handler() {\n      return _handler(apiOptions, actions);\n    }\n  };\n};"]},"metadata":{},"sourceType":"script"}