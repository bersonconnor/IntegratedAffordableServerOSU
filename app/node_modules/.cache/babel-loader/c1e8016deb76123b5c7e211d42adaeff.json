{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _handler = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(apiOptions, actions) {\n    var navigateToDir, updateNotifications, getResource, getNotifications, getMessage, notificationId, notificationChildId, prevResourceId, onStart, onProgress, resource, file, response, newResource, notifications, notification, notificationChildrenCount, newNotifications;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            navigateToDir = actions.navigateToDir, updateNotifications = actions.updateNotifications, getResource = actions.getResource, getNotifications = actions.getNotifications;\n            getMessage = _translations2.default.bind(null, apiOptions.locale);\n            notificationId = label;\n            notificationChildId = (0, _nanoid2.default)();\n            prevResourceId = getResource().id;\n\n            onStart = function onStart(_ref2) {\n              var name = _ref2.name,\n                  size = _ref2.size;\n              var notifications = getNotifications();\n\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n\n              var childElement = {\n                elementType: 'NotificationProgressItem',\n                elementProps: {\n                  title: name,\n                  progress: 0,\n                  icon: (0, _icons.getIcon)({\n                    name: name\n                  })\n                }\n              };\n\n              var newChildren = _notifications2.default.addChild(notification && notification.children || [], notificationChildId, childElement);\n\n              var newNotification = {\n                title: newChildren.length > 1 ? getMessage('uploadingItems', {\n                  quantity: newChildren.length\n                }) : getMessage('uploadingItem'),\n                children: newChildren\n              };\n              var newNotifications = notification ? _notifications2.default.updateNotification(notifications, notificationId, newNotification) : _notifications2.default.addNotification(notifications, notificationId, newNotification);\n              updateNotifications(newNotifications);\n            };\n\n            onProgress = function onProgress(progress) {\n              var notifications = getNotifications();\n\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n\n              var child = _notifications2.default.getChild(notification.children, notificationChildId);\n\n              var newChild = (0, _extends3.default)({}, child, {\n                element: (0, _extends3.default)({}, child.element, {\n                  elementProps: (0, _extends3.default)({}, child.element.elementProps, {\n                    progress: progress\n                  })\n                })\n              });\n\n              var newChildren = _notifications2.default.updateChild(notification.children, notificationChildId, newChild);\n\n              var newNotifications = _notifications2.default.updateNotification(notifications, notificationId, {\n                children: newChildren\n              });\n\n              updateNotifications(newNotifications);\n            };\n\n            resource = getResource();\n            _context.prev = 8;\n            _context.next = 11;\n            return (0, _upload.readLocalFile)(true);\n\n          case 11:\n            file = _context.sent;\n            onStart({\n              name: file.name,\n              size: file.file.size\n            });\n            _context.next = 15;\n            return _api2.default.uploadFileToId({\n              apiOptions: apiOptions,\n              parentId: resource.id,\n              file: file,\n              onProgress: onProgress\n            });\n\n          case 15:\n            response = _context.sent;\n            newResource = (0, _common.normalizeResource)(response.body[0]);\n            notifications = getNotifications();\n            notification = _notifications2.default.getNotification(notifications, notificationId);\n            notificationChildrenCount = notification.children.length;\n            newNotifications = void 0;\n\n            if (notificationChildrenCount > 1) {\n              newNotifications = _notifications2.default.updateNotification(notifications, notificationId, {\n                children: _notifications2.default.removeChild(notification.children, notificationChildId)\n              });\n            } else {\n              newNotifications = _notifications2.default.removeNotification(notifications, notificationId);\n            }\n\n            updateNotifications(newNotifications);\n\n            if (prevResourceId === resource.id) {\n              navigateToDir(resource.id, newResource.id, false);\n            }\n\n            _context.next = 30;\n            break;\n\n          case 26:\n            _context.prev = 26;\n            _context.t0 = _context['catch'](8);\n            (0, _onFailError2.default)({\n              getNotifications: getNotifications,\n              label: getMessage(label),\n              notificationId: notificationId,\n              updateNotifications: updateNotifications\n            });\n            console.log(_context.t0);\n\n          case 30:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this, [[8, 26]]);\n  }));\n\n  return function _handler(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar _api = require('../api');\n\nvar _api2 = _interopRequireDefault(_api);\n\nvar _notifications = require('../utils/notifications');\n\nvar _notifications2 = _interopRequireDefault(_notifications);\n\nvar _icons = require('../icons');\n\nvar _nanoid = require('nanoid');\n\nvar _nanoid2 = _interopRequireDefault(_nanoid);\n\nvar _onFailError = require('../utils/onFailError');\n\nvar _onFailError2 = _interopRequireDefault(_onFailError);\n\nvar _upload = require('../utils/upload');\n\nvar _iconsSvg = require('../icons-svg');\n\nvar _iconsSvg2 = _interopRequireDefault(_iconsSvg);\n\nvar _translations = require('../translations');\n\nvar _translations2 = _interopRequireDefault(_translations);\n\nvar _common = require('../utils/common');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar label = 'upload';\n\nexports.default = function (apiOptions, actions) {\n  var localeLabel = (0, _translations2.default)(apiOptions.locale, label);\n  var getResource = actions.getResource;\n  return {\n    id: label,\n    icon: {\n      svg: _iconsSvg2.default.fileUpload\n    },\n    label: localeLabel,\n    shouldBeAvailable: function shouldBeAvailable(apiOptions) {\n      var resource = getResource();\n\n      if (!resource || !resource.capabilities) {\n        return false;\n      }\n\n      return resource.capabilities.canAddChildren;\n    },\n    availableInContexts: ['files-view', 'new-button'],\n    handler: function handler() {\n      return _handler(apiOptions, actions);\n    }\n  };\n};","map":{"version":3,"sources":["/home/ubuntu/Connor/Demo_OSU_Filemanager/node_modules/@opuscapita/react-filemanager-connector-node-v1/lib/capabilities/upload.js"],"names":["Object","defineProperty","exports","value","_regenerator","require","_regenerator2","_interopRequireDefault","_extends2","_extends3","_asyncToGenerator2","_asyncToGenerator3","_handler","_ref","default","mark","_callee","apiOptions","actions","navigateToDir","updateNotifications","getResource","getNotifications","getMessage","notificationId","notificationChildId","prevResourceId","onStart","onProgress","resource","file","response","newResource","notifications","notification","notificationChildrenCount","newNotifications","wrap","_callee$","_context","prev","next","_translations2","bind","locale","label","_nanoid2","id","_ref2","name","size","_notifications2","getNotification","childElement","elementType","elementProps","title","progress","icon","_icons","getIcon","newChildren","addChild","children","newNotification","length","quantity","updateNotification","addNotification","child","getChild","newChild","element","updateChild","_upload","readLocalFile","sent","_api2","uploadFileToId","parentId","_common","normalizeResource","body","removeChild","removeNotification","t0","_onFailError2","console","log","stop","_x","_x2","apply","arguments","_api","_notifications","_nanoid","_onFailError","_iconsSvg","_iconsSvg2","_translations","obj","__esModule","localeLabel","svg","fileUpload","shouldBeAvailable","capabilities","canAddChildren","availableInContexts","handler"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _handler = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(apiOptions, actions) {\n    var navigateToDir, updateNotifications, getResource, getNotifications, getMessage, notificationId, notificationChildId, prevResourceId, onStart, onProgress, resource, file, response, newResource, notifications, notification, notificationChildrenCount, newNotifications;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            navigateToDir = actions.navigateToDir, updateNotifications = actions.updateNotifications, getResource = actions.getResource, getNotifications = actions.getNotifications;\n            getMessage = _translations2.default.bind(null, apiOptions.locale);\n            notificationId = label;\n            notificationChildId = (0, _nanoid2.default)();\n            prevResourceId = getResource().id;\n\n            onStart = function onStart(_ref2) {\n              var name = _ref2.name,\n                  size = _ref2.size;\n\n              var notifications = getNotifications();\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n              var childElement = {\n                elementType: 'NotificationProgressItem',\n                elementProps: {\n                  title: name,\n                  progress: 0,\n                  icon: (0, _icons.getIcon)({ name: name })\n                }\n              };\n\n              var newChildren = _notifications2.default.addChild(notification && notification.children || [], notificationChildId, childElement);\n              var newNotification = {\n                title: newChildren.length > 1 ? getMessage('uploadingItems', { quantity: newChildren.length }) : getMessage('uploadingItem'),\n                children: newChildren\n              };\n\n              var newNotifications = notification ? _notifications2.default.updateNotification(notifications, notificationId, newNotification) : _notifications2.default.addNotification(notifications, notificationId, newNotification);\n\n              updateNotifications(newNotifications);\n            };\n\n            onProgress = function onProgress(progress) {\n              var notifications = getNotifications();\n              var notification = _notifications2.default.getNotification(notifications, notificationId);\n              var child = _notifications2.default.getChild(notification.children, notificationChildId);\n              var newChild = (0, _extends3.default)({}, child, {\n                element: (0, _extends3.default)({}, child.element, {\n                  elementProps: (0, _extends3.default)({}, child.element.elementProps, {\n                    progress: progress\n                  })\n                })\n              });\n              var newChildren = _notifications2.default.updateChild(notification.children, notificationChildId, newChild);\n              var newNotifications = _notifications2.default.updateNotification(notifications, notificationId, { children: newChildren });\n              updateNotifications(newNotifications);\n            };\n\n            resource = getResource();\n            _context.prev = 8;\n            _context.next = 11;\n            return (0, _upload.readLocalFile)(true);\n\n          case 11:\n            file = _context.sent;\n\n            onStart({ name: file.name, size: file.file.size });\n            _context.next = 15;\n            return _api2.default.uploadFileToId({ apiOptions: apiOptions, parentId: resource.id, file: file, onProgress: onProgress });\n\n          case 15:\n            response = _context.sent;\n            newResource = (0, _common.normalizeResource)(response.body[0]);\n            notifications = getNotifications();\n            notification = _notifications2.default.getNotification(notifications, notificationId);\n            notificationChildrenCount = notification.children.length;\n            newNotifications = void 0;\n\n            if (notificationChildrenCount > 1) {\n              newNotifications = _notifications2.default.updateNotification(notifications, notificationId, {\n                children: _notifications2.default.removeChild(notification.children, notificationChildId)\n              });\n            } else {\n              newNotifications = _notifications2.default.removeNotification(notifications, notificationId);\n            }\n            updateNotifications(newNotifications);\n            if (prevResourceId === resource.id) {\n              navigateToDir(resource.id, newResource.id, false);\n            }\n            _context.next = 30;\n            break;\n\n          case 26:\n            _context.prev = 26;\n            _context.t0 = _context['catch'](8);\n\n            (0, _onFailError2.default)({\n              getNotifications: getNotifications,\n              label: getMessage(label),\n              notificationId: notificationId,\n              updateNotifications: updateNotifications\n            });\n            console.log(_context.t0);\n\n          case 30:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this, [[8, 26]]);\n  }));\n\n  return function _handler(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar _api = require('../api');\n\nvar _api2 = _interopRequireDefault(_api);\n\nvar _notifications = require('../utils/notifications');\n\nvar _notifications2 = _interopRequireDefault(_notifications);\n\nvar _icons = require('../icons');\n\nvar _nanoid = require('nanoid');\n\nvar _nanoid2 = _interopRequireDefault(_nanoid);\n\nvar _onFailError = require('../utils/onFailError');\n\nvar _onFailError2 = _interopRequireDefault(_onFailError);\n\nvar _upload = require('../utils/upload');\n\nvar _iconsSvg = require('../icons-svg');\n\nvar _iconsSvg2 = _interopRequireDefault(_iconsSvg);\n\nvar _translations = require('../translations');\n\nvar _translations2 = _interopRequireDefault(_translations);\n\nvar _common = require('../utils/common');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar label = 'upload';\n\nexports.default = function (apiOptions, actions) {\n  var localeLabel = (0, _translations2.default)(apiOptions.locale, label);\n  var getResource = actions.getResource;\n\n  return {\n    id: label,\n    icon: { svg: _iconsSvg2.default.fileUpload },\n    label: localeLabel,\n    shouldBeAvailable: function shouldBeAvailable(apiOptions) {\n      var resource = getResource();\n      if (!resource || !resource.capabilities) {\n        return false;\n      }\n      return resource.capabilities.canAddChildren;\n    },\n    availableInContexts: ['files-view', 'new-button'],\n    handler: function handler() {\n      return _handler(apiOptions, actions);\n    }\n  };\n};"]},"metadata":{},"sourceType":"script"}